<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>COORDIS ‚Äî –†–æ–ª–∏</title>
    <link rel="stylesheet" th:href="@{/static/css/style.css}">
</head>
<body>
<header>
    <a href="/home" class="logo">COORDIS</a>
    <div th:if="${email != null}" class="auth-buttons nav-right">
        <a href="/admin/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a> |
        <a href="/projects">–ü—Ä–æ–µ–∫—Ç—ã</a>
    </div>
</header>

<main style="text-align: left; max-width: 1000px; margin: 2rem auto;">
    <h2>–†–æ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ</h2>

    <!-- === –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ–ª–∏ === -->
    <div class="project-form-container" style="margin-bottom: 2.5rem;">
        <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å</h2>
        <form method="post" action="/admin/roles">
            <div class="form-group">
                <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ *</label>
                <input type="text" id="name" name="name" required>
            </div>

            <div class="form-group">
                <label for="projectPermission">–ü—Ä–∞–≤–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç—ã *</label>
                <select id="projectPermission" name="projectPermission" required>
                    <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
                    <option th:each="p : ${permissions}"
                            th:value="${p}"
                            th:text="${p.name}">
                    </option>
                </select>
            </div>

            <div class="form-group">
                <label for="taskPermission">–ü—Ä–∞–≤–∞ –Ω–∞ –∑–∞–¥–∞—á–∏ *</label>
                <select id="taskPermission" name="taskPermission" required>
                    <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
                    <option th:each="p : ${permissions}"
                            th:value="${p}"
                            th:text="${p.name}">
                    </option>
                </select>
            </div>

            <div class="form-group">
                <label for="userPermission">–ü—Ä–∞–≤–∞ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ *</label>
                <select id="userPermission" name="userPermission" required>
                    <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
                    <option th:each="p : ${permissions}"
                            th:value="${p}"
                            th:text="${p.name}">
                    </option>
                </select>
            </div>

            <div class="form-group">
                <label for="rolePermission">–ü—Ä–∞–≤–∞ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ *</label>
                <select id="rolePermission" name="rolePermission" required>
                    <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
                    <option th:each="p : ${permissions}"
                            th:value="${p}"
                            th:text="${p.name}">
                    </option>
                </select>
            </div>

            <button type="submit" class="submit-button">–°–æ–∑–¥–∞—Ç—å —Ä–æ–ª—å</button>
        </form>
    </div>

    <!-- === –¢–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ä–æ–ª–µ–π === -->
    <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–æ–ª–∏</h3>

    <table class="table" th:unless="${roles.empty}">
        <thead>
        <tr>
            <th>ID</th>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–ü—Ä–æ–µ–∫—Ç—ã</th>
            <th>–ó–∞–¥–∞—á–∏</th>
            <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</th>
            <th>–†–æ–ª–∏</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="role : ${roles}">
            <form method="post" th:action="@{/admin/roles/update}" style="display: contents;">
                <input type="hidden" name="id" th:value="${role.id}">
                <td th:text="${role.id}"></td>
                <td><input type="text" name="name" th:value="${role.name}" style="width: 100%; background: #1a1a1a; color: #e0e0e0; border: 1px solid #333;"></td>
                <td>
                    <select name="projectPermission">
                        <option th:each="p : ${permissions}"
                                th:value="${p}"
                                th:text="${p.name}"
                                th:selected="${p == role.projectPermission}">
                        </option>
                    </select>
                </td>
                <td>
                    <select name="taskPermission">
                        <option th:each="p : ${permissions}"
                                th:value="${p}"
                                th:text="${p.name}"
                                th:selected="${p == role.taskPermission}">
                        </option>
                    </select>
                </td>
                <td>
                    <select name="userPermission">
                        <option th:each="p : ${permissions}"
                                th:value="${p}"
                                th:text="${p.name}"
                                th:selected="${p == role.userPermission}">
                        </option>
                    </select>
                </td>
                <td>
                    <select name="rolePermission">
                        <option th:each="p : ${permissions}"
                                th:value="${p}"
                                th:text="${p.name}"
                                th:selected="${p == role.rolePermission}">
                        </option>
                    </select>
                </td>
                <td>
                    <!-- –§–æ—Ä–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
                    <form method="post" th:action="@{/admin/roles/update}" style="display:inline;">
                        <input type="hidden" name="id" th:value="${role.id}">
                        <input type="hidden" name="name" th:value="${role.name}">
                        <input type="hidden" name="projectPermission" th:value="${role.projectPermission}">
                        <input type="hidden" name="taskPermission" th:value="${role.taskPermission}">
                        <input type="hidden" name="userPermission" th:value="${role.userPermission}">
                        <input type="hidden" name="rolePermission" th:value="${role.rolePermission}">
                        <button type="submit" class="submit-button" style="padding: 0.3rem 0.6rem; font-size: 0.9rem;">üíæ</button>
                    </form>

                    <!-- –§–æ—Ä–º–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
                    <form th:action="@{/admin/roles/delete/{id}(id=${role.id})}" method="post" style="display:inline;">
                        <button type="submit" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å?')" style="color: #ff4d4d; background: none; border: none; cursor: pointer; margin-left: 0.5rem;">üóëÔ∏è</button>
                    </form>
                </td>
            </form>
        </tr>
        </tbody>
    </table>

    <div th:if="${roles.empty}">
        <p>–í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ä–æ–ª–µ–π.</p>
    </div>
</main>
</body>
</html>